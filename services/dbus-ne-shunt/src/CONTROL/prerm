#!/bin/bash

set -e

if [ -z "$D" ]; then

  # remove extension .prerm from /var/lib/dpkg/info/dbus-ne-shunt.prerm
  # and add "install-helper"
  # note shellcheck requires +xn arguments
  # shellcheck source=./install-helper
  source "${0%.*}".install-helper

  # get service name from path by removing the extenion prerm from 
  # /path/dbus-ne-shunt.prerm
  # and using just returning the basename not the full path.
  SERVICE_NAME=$(basename "${0%.*}") #get file name without path
  VE_SERVICE_MAPPING_NAME="neshunt"
  TTY_FILE="/data/${SERVICE_NAME}/serial-starter.devname"
  SERIAL_STARTER_RULE_FILE="/data/${SERVICE_NAME}/serial-starter.rule"
  DBUS_MESSAGE_PATH="" #"com.victronenergy.packageManager /GuiEditStatus"
  #TEST_USB_ID="1a86:55d3"

  init_default_path_variables

  stop_and_remove_service

  remove_usb_serial_device

  remove_ve_service_config_file_mapping

  remove_ensure_installed_script_from_rc_local

  echo "${SERVICE_NAME}" removed

fi